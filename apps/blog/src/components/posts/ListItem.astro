---
import type { BlogSchema } from '@/content.config';
import ItemFooter from './ItemFooter.astro';

interface Props {
  post: BlogSchema;
}

const { post } = Astro.props;
---

<li>
  <div
    class="min-w-xl flex flex-col rounded-2xl px-4 pt-3 pb-2 border-dashed border-zinc-800/5 border-1 hover:bg-zinc-50 transition-colors duration-200 cursor-pointer"
    data-post
  >
    <h2 class="font-bold" style={`view-transition-name: ${post.slug}-title`}>
      <a
        href={`/posts/${post.slug}`}
        class="hover:text-violet-800 transition-colors duration-200 no-underline"
        data-post-url
      >
        {post.title}
      </a>
    </h2>
    {
      post.description.length >= 200 && (
        <div
          class="font-light text-zinc-500 break-all leading-loose line-clamp-3"
          style={`view-transition-name: ${post.slug}-description`}
        >
          {post.description}
        </div>
      )
    }
    <ItemFooter post={post} />
  </div>
</li>

<script>
  document.addEventListener('astro:page-load', () => {
    const listItems = document.querySelectorAll('div[data-post]');
    listItems.forEach((item) => {
      item.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        if (target.tagName === 'A' || target.closest('a')) {
          return;
        }
        const link = item.querySelector<HTMLAnchorElement>('a[data-post-url]');
        link?.click();
      });
    });
  });
</script>
