---
import { getCollection, render } from 'astro:content';
import { sortByCreatedAt } from '../../utils/collection';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { Comments } from '@/components/posts/Comments';
import Article from '@/components/posts/Article.astro';
import { Toc } from '@/components/posts/Toc';

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const sortedPosts = posts.toSorted(sortByCreatedAt);
  return sortedPosts.map((post, i) => ({
    params: { slug: post.data.slug },
    props: {
      post,
      prevPost: sortedPosts[i - 1],
      nextPost: sortedPosts[i + 1],
    },
  }));
}
// 2. For your template, you can get the entry directly from the prop
const { post, prevPost, nextPost } = Astro.props;
const { headings } = await render(post);
---

<BaseLayout title={post.data.title}>
  <div class="flex flex-row relative">
    <div>
      <Article post={post} />
      <div class="my-10 border-t-1 border-zinc-800/5"></div>
      <Comments client:visible />
    </div>

    <aside class="ml-20 sticky h-0 top-[25%]">
      <Toc headings={headings} />
    </aside>
  </div>
</BaseLayout>
