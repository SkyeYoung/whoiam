---
import { render } from 'astro:content';
import { getBlogCollection } from '../../utils/collection';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { Comments } from '@/components/posts/Comments';
import Article from '@/components/posts/Article.astro';
import { Toc } from '@/components/posts/Toc';
import { BackToTop } from '@/components/posts/BackToTop';

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const posts = await getBlogCollection();
  return posts.map((post, i) => ({
    params: { slug: post.data.slug },
    props: {
      post,
      prevPost: posts[i - 1],
      nextPost: posts[i + 1],
    },
  }));
}
// 2. For your template, you can get the entry directly from the prop
const { post, prevPost, nextPost } = Astro.props;
const { headings } = await render(post);
---

<BaseLayout title={post.data.title}>
  <div class="flex flex-row relative">
    <section>
      <Article post={post} />
      <div class="my-10 border-t-1 border-zinc-800/5"></div>
      <Comments client:visible />
    </section>

    <aside class="ml-10 sticky h-0 top-[25%]">
      <div class="backdrop-blur-md shadow-zinc-800/5 rounded-md p-2">
        <Toc headings={headings} client:idle />
        <BackToTop client:idle />
      </div>
    </aside>
  </div>
</BaseLayout>
